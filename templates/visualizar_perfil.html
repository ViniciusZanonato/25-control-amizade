{% extends "base.html" %}

{% block title %}Perfil de {{ aluno.usuario.nome }} - NeuroLearn{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-12">
            <div class="card border-primary">
                <div class="card-header bg-primary text-white">
                    <div class="row">
                        <div class="col-md-8">
                            <h2><i class="fas fa-user-graduate"></i> Perfil de Aprendizagem NeuroLearn</h2>
                            <h4>{{ aluno.usuario.nome }}</h4>
                            <p class="mb-0">{{ aluno.serie_ano }} - Prof. Responsável: {{ aluno.professor_responsavel }}</p>
                        </div>
                        <div class="col-md-4 text-right">
                            {% if perfil %}
                            <span class="badge badge-success badge-lg">
                                <i class="fas fa-check-circle"></i> Perfil Gerado
                            </span><br>
                            <small>{{ perfil.data_geracao.strftime('%d/%m/%Y às %H:%M') }}</small>
                            {% else %}
                            <span class="badge badge-warning badge-lg">
                                <i class="fas fa-clock"></i> Perfil Pendente
                            </span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                {% if perfil %}
                <div class="card-body">
                    
                    <!-- Tipo de Perfil -->
                    {% if perfil.tipo_perfil %}
                    <div class="alert alert-info text-center mb-4">
                        <h4><i class="fas fa-tag"></i> Tipo de Perfil: <strong>
                            {% if perfil_formatado %}
                                {{ perfil_formatado.tipo_perfil }}
                            {% else %}
                                {{ perfil.tipo_perfil }}
                            {% endif %}
                        </strong></h4>
                    </div>
                    {% endif %}

                    <!-- Perfil Geral -->
                    <div class="card mb-4">
                        <div class="card-header bg-primary text-white">
                            <h5><i class="fas fa-user"></i> Perfil Geral de Aprendizagem</h5>
                        </div>
                        <div class="card-body">
                            <p class="lead">
                                {% if perfil_formatado %}
                                    {{ perfil_formatado.perfil_geral|replace('\n', '<br>')|safe }}
                                {% else %}
                                    {{ perfil.perfil_geral }}
                                {% endif %}
                            </p>
                        </div>
                    </div>

                    <!-- Potenciais Expressivos e Cognitivos -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header bg-info text-white">
                                    <h5><i class="fas fa-palette"></i> Potenciais Expressivos</h5>
                                </div>
                                <div class="card-body">
                                    <p>
                                        {% if perfil_formatado %}
                                            {{ perfil_formatado.potenciais_expressivos|replace('\n', '<br>')|safe }}
                                        {% else %}
                                            {{ perfil.potenciais_expressivos }}
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header bg-warning text-dark">
                                    <h5><i class="fas fa-brain"></i> Potenciais Cognitivos</h5>
                                </div>
                                <div class="card-body">
                                    <p>
                                        {% if perfil_formatado %}
                                            {{ perfil_formatado.potenciais_cognitivos|replace('\n', '<br>')|safe }}
                                        {% else %}
                                            {{ perfil.potenciais_cognitivos }}
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Indícios de Neurodivergências -->
                    {% if perfil.indicios_neurodivergencias %}
                    <div class="card mb-4">
                        <div class="card-header bg-secondary text-white">
                            <h5><i class="fas fa-search"></i> Características Especiais de Aprendizagem</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-light border-left border-warning">
                                <small class="text-muted">
                                    <i class="fas fa-info-circle"></i> 
                                    <strong>Importante:</strong> Esta análise é baseada em padrões de resposta e destina-se exclusivamente 
                                    a orientações pedagógicas. Não substitui avaliação clínica profissional.
                                </small>
                            </div>
                            <p>
                                {% if perfil_formatado %}
                                    {{ perfil_formatado.indicios_neurodivergencias|replace('\n', '<br>')|safe }}
                                {% else %}
                                    {{ perfil.indicios_neurodivergencias }}
                                {% endif %}
                            </p>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Recomendações para Professores -->
                    <div class="card mb-4">
                        <div class="card-header bg-success text-white">
                            <h5><i class="fas fa-chalkboard-teacher"></i> Recomendações Pedagógicas</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-success">
                                <i class="fas fa-lightbulb"></i> 
                                <strong>Estratégias personalizadas para potencializar o aprendizado:</strong>
                            </div>
                            <div class="recommendations-content">
                                {% if perfil_formatado %}
                                    {{ perfil_formatado.recomendacoes_professores|replace('\n', '<br>')|safe }}
                                {% else %}
                                    {{ perfil.recomendacoes_professores|replace('\n', '<br>')|safe }}
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Reforço Motivacional -->
                    <div class="card mb-4">
                        <div class="card-header bg-dark text-white">
                            <h5><i class="fas fa-heart"></i> Mensagem Motivacional do Aluno</h5>
                        </div>
                        <div class="card-body">
                            <blockquote class="blockquote text-center">
                                <p class="mb-0">
                                    {% if perfil_formatado %}
                                        {{ perfil_formatado.reforco_motivacional|replace('\n', '<br>')|safe }}
                                    {% else %}
                                        {{ perfil.reforco_motivacional }}
                                    {% endif %}
                                </p>
                                <footer class="blockquote-footer">Para {{ aluno.usuario.nome }}</footer>
                            </blockquote>
                        </div>
                    </div>

                    <!-- Ações -->
                    <div class="row">
                        <div class="col-md-6">
                            <a href="{{ url_for('painel_professor') }}" class="btn btn-outline-primary btn-block">
                                <i class="fas fa-arrow-left"></i> Voltar ao Painel
                            </a>
                        </div>
                        <div class="col-md-6">
                            <button class="btn btn-success btn-block" onclick="window.print()">
                                <i class="fas fa-download"></i> Baixar PDF
                            </button>
                        </div>
                    </div>
                </div>
                
                {% else %}
                <div class="card-body text-center">
                    <div class="py-5">
                        <i class="fas fa-hourglass-half fa-3x text-warning mb-3"></i>
                        <h4>Perfil em Processamento</h4>
                        <p class="text-muted">
                            {% if aluno.questionario_completo %}
                                O aluno completou o questionário e o perfil está sendo gerado pela IA.
                                <br>Aguarde alguns minutos e recarregue a página.
                            {% else %}
                                O aluno ainda não completou o Questionário NeuroLearn.
                                <br>Solicite que ele faça login e responda às 67 questões.
                            {% endif %}
                        </p>
                        <a href="{{ url_for('painel_professor') }}" class="btn btn-primary">
                            <i class="fas fa-arrow-left"></i> Voltar ao Painel
                        </a>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
@media print {
    .btn, .card-header, nav, footer, .alert {
        display: none !important;
    }
    .card {
        border: none !important;
        box-shadow: none !important;
    }
    .recommendations-content {
        border: 1px solid #000;
        padding: 10px;
        margin: 10px 0;
    }
    h1, h2, h3, h4, h5 {
        color: #000 !important;
    }
}

.badge-lg {
    font-size: 0.9em;
    padding: 0.5em 0.75em;
}

.border-left {
    border-left: 4px solid #ffc107 !important;
}
</style>
{% endblock %}

